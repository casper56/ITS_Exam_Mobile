<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITS Software Development Ê®°Êì¨Ê∏¨È©ó</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarized-light.min.css" rel="stylesheet" />
    <style>
        body { background-color: #f8f9fa; font-family: "Microsoft JhengHei", sans-serif; }
        .exam-header { position: fixed; top: 0; left: 0; right: 0; z-index: 1050; background: #212529; color: white; padding: 10px 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .timer-box { font-size: 1.5rem; font-weight: bold; color: #ffc107; }
        .main-content { margin-top: 80px; padding-bottom: 100px; }
        .question-card { border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); background: #fff; border-radius: 8px; margin-bottom: 25px; }
        .question-header { border-bottom: 2px solid #0d6efd; padding: 15px 20px; font-weight: bold; color: #0d6efd; }
        .question-body { padding: 15px 20px; font-size: 1.05rem; }
        .option-item { border: 1px solid #e9ecef; border-radius: 8px; padding: 10px; margin-bottom: 8px; cursor: pointer; transition: 0.2s; background: #fff; }
        .option-item:hover { background: #f8f9fa; }
        .option-item.selected { background: #cfe2ff; border-color: #0d6efd; color: #084298; font-weight: bold; }
        .sub-opt-container { padding: 6px 10px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: #fff; }
        .sub-opt-container.selected { background: #cfe2ff; border-color: #0d6efd; font-weight: bold; }
        #result-screen { display: none; text-align: center; padding: 50px 20px; }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; border: 8px solid #0d6efd; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: bold; margin: 20px auto; color: #0d6efd; }
        .side-nav-btn { position: fixed; top: 55%; transform: translateY(-50%); width: 40px; height: 100px; background: rgba(13, 110, 253, 0.8); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1060; font-size: 1.5rem; border: none; border-radius: 0 50px 50px 0; }
        .side-nav-next { right: 0; border-radius: 50px 0 0 50px; }
        #review-area { display: none; text-align: left; margin-top: 30px; }
        .review-item { margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        @media print { .no-print { display: none !important; } #review-area { display: block !important; } }
    </style>
</head>
<body>
<div id="exam-ui">
    <header class="exam-header d-flex justify-content-between align-items-center">
        <div><h5 class="m-0">ITS Software Development Ê®°Êì¨Ê∏¨È©ó</h5><small id="q-progress">1 / 50</small></div>
        <div class="timer-box" id="timer">50:00</div>
        <button class="btn btn-danger btn-sm" onclick="confirmSubmit()">‰∫§Âç∑</button>
    </header>
    <div class="side-nav-btn side-nav-prev" id="side-btn-prev" onclick="changeQuestion(-1)">&#10094;</div>
    <div class="side-nav-btn side-nav-next" id="side-btn-next" onclick="changeQuestion(1)">&#10095;</div>
    <main class="container main-content"><div id="question-area"></div></main>
</div>
<div id="result-screen" class="container">
    <h2 class="mb-4">ËÄÉË©¶ÁµêÊùü</h2><div class="score-circle" id="final-score">0</div>
    <p class="lead">Á≠îÂ∞çÈ°åÊï∏Ôºö<span id="correct-count">0</span> / 50</p>
    <div id="category-stats" class="mb-4"></div>
    <div class="mt-5 no-print">
        <a href="../index.html" class="btn btn-primary btn-lg me-2">ÂõûÈ¶ñÈ†Å</a>
        <button class="btn btn-warning btn-lg me-2 px-4" onclick="startRetake()">üéØ ÂïüÂãïÊú¨Ê¨°ÈåØÈ°åÂº∑ÂåñÁâπË®ì</button>
        <button class="btn btn-outline-secondary btn-lg me-2" onclick="location.reload()">ÈáçÊñ∞ÊåëÊà∞</button>
    </div>
    <div id="review-area"><div id="review-list"></div></div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
<script>
    var examQuestions = [], userAnswers = {}, currentIndex = 0, timerInterval, timeLeft = 50 * 60;
    var lastWrongQuestions = [], isRetakeMode = false;
    var WRONG_KEY = 'its_soft_wrongs';

    function initExam(retakeItems) {
        if (!allQuestions || allQuestions.length === 0) return;
        if (retakeItems && retakeItems.length > 0) {
            isRetakeMode = true; examQuestions = JSON.parse(JSON.stringify(retakeItems));
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('exam-ui').style.display = 'block';
            currentIndex = 0; userAnswers = {}; renderQuestion(0); startTimer(); return;
        }
        isRetakeMode = false;
        var selected = allQuestions.slice(0, 50).sort(function() { return 0.5 - Math.random(); });
        examQuestions = selected; renderQuestion(0); startTimer();
    }

    function startTimer() { timerInterval = setInterval(function() { timeLeft--; var m = Math.floor(timeLeft/60), s = timeLeft%60; document.getElementById('timer').innerText = m + ":" + (s < 10 ? '0' + s : s); if (timeLeft <= 0) submitExam(); }, 1000); }

    function renderQuestion(index) {
        currentIndex = index; var item = examQuestions[index]; var container = document.getElementById('question-area');
        document.getElementById('q-progress').innerText = (index + 1) + " / " + examQuestions.length;
        var html = '<div class="card question-card"><div class="question-header">Question ' + (index + 1) + '</div><div class="question-body">' + item.question + '<div class="mt-3">';
        (item.quiz || item.options || []).forEach(function(opt, i) {
            var isSel = (userAnswers[index] === i);
            html += '<div class="option-item ' + (isSel ? 'selected' : '') + '" onclick="selectOption(' + i + ')">' + (i + 1) + '. ' + opt + '</div>';
        });
        html += '</div></div></div>'; container.innerHTML = html; Prism.highlightAll(); window.scrollTo(0, 0);
    }

    function selectOption(i) { userAnswers[currentIndex] = i; renderQuestion(currentIndex); }
    function changeQuestion(d) { var n = currentIndex + d; if (n >= 0 && n < examQuestions.length) renderQuestion(n); }
    function confirmSubmit() { if (confirm("Á¢∫ÂÆöË¶Å‰∫§Âç∑ÂóéÔºü")) submitExam(); }

    function submitExam() {
        clearInterval(timerInterval); document.getElementById('exam-ui').style.display = 'none'; document.getElementById('result-screen').style.display = 'block';
        var correct = 0; lastWrongQuestions = [];
        examQuestions.forEach(function(item, i) {
            var isCorrect = (userAnswers[i] === (parseInt(item.answer[0]) - 1));
            if (isCorrect) correct++; else lastWrongQuestions.push(item);
        });
        document.getElementById('correct-count').innerText = correct;
        document.getElementById('final-score').innerText = Math.round((correct / examQuestions.length) * 100);
    }

    function startRetake() { initExam(lastWrongQuestions); }

    const allQuestions = {{JSON_DATA}};
    initExam();
</script>
</body>
</html>
